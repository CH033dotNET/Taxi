@using Common.Helpers
@model MainSaite.Models.AutoParkViewModel

@{
	ViewBag.Title = "CarEditor";
	string username = (Session["user"] as Model.DTO.UserDTO).UserName;
}
@Styles.Render("~/Content/BootstrapCallout.css")
@Styles.Render("~/Content/bootstrap-datetimepicker.css")
<link rel="stylesheet" href="~/Content/AutoParkCustomStyles.css" type="text/css" />

<div>
	<div class="page-header">
		<h1>@Resources.Resource.Greeting,<small>@username</small></h1>
	</div>
	<div class="panel panel-info">
		<div class="panel-heading">
			<h3 class="panel-title">@Resources.Resource.Garage</h3>
		</div>
		<div class="panel-body">
			<div class="bs-callout bs-callout-primary">
				<h4>@Resources.Resource.GarageHeader1</h4>
				@Resources.Resource.GarageAttention1
			</div>
			<div class="bs-callout bs-callout-warning">
				<h4>@Resources.Resource.GarageHeader2</h4>
				@Resources.Resource.GarageAttention2
			</div>
		</div>
		<div class="panel-footer">
			<a class="btn btn-success" role="button" onclick="carController.addNewCar()">
				<span class="glyphicon glyphicon-th-list" aria-hidden="true">&nbsp;</span>@Resources.Resource.AddNewCar
			</a>
		</div>
		<div class="table-list">
			<div class="table-responsive">
				<table class="table table-striped" id="CarParkTable">
					<thead>
						<tr class="info">
							<th>
								@Resources.Resource.CarName
							</th>
							<th>
								@Resources.Resource.CarNickName
							</th>
							<th>
								@Resources.Resource.CarNumber
							</th>
							<th>
								@Resources.Resource.CarState
							</th>
							<th>
								@Resources.Resource.ActionsColumn
							</th>
						</tr>
					</thead>
					<tbody>
						<script id="carListRow" type="text/x-handlebars-template">
							{{#each cars}}
							<tr>
								<td>
									{{this.CarName}}
								</td>
								<td>
									{{CarNickName}}
								</td>
								<td>
									{{CarNumber}}
								</td>
								<td>
									{{CarStateDescription}}
								</td>
								<td>
									{{#ifCond OwnerId UserId}}
									<a class="btn btn-warning" href="#"
									   data-cars-id="{{Id}}"
									   data-cars-name="{{CarName}}"
									   data-cars-nname="{{CarNickName}}"
									   data-cars-number="{{CarNumber}}"
									   data-cars-occup="{{CarOccupation}}"
									   data-cars-class="{{CarClass}}"
									   data-cars-petroltype="{{CarPetrolType}}"
									   data-cars-consum="{{CarPetrolConsumption}}"
									   data-cars-date="{{CarManufactureDate}}"
									   data-cars-state="{{CarState}}"
									   role="button" onclick="carController.editCar(this)">
										<span class="glyphicon glyphicon-cog" aria-hidden="true">&nbsp;</span>@Resources.Resource.editString
									</a>
									{{/ifCond}}
									{{#ifCond OwnerId UserId}}
									<a class="btn btn-danger" href="#" data-cars-id="{{Id}}" data-cars-name="{{CarName}}" role="button" onclick="carController.deleteCar(this)">
										<span class="glyphicon glyphicon-trash" aria-hidden="true">&nbsp;</span>@Resources.Resource.deleteString
									</a>
									{{/ifCond}}
									<a class="btn btn-info" href="#"
									   data-cars-id="{{Id}}"
									   data-cars-name="{{CarName}}"
									   data-cars-nname="{{CarNickName}}"
									   data-cars-number="{{CarNumber}}"
									   data-cars-occup="{{CarOccupation}}"
									   data-cars-class="{{CarClassDescription}}"
									   data-cars-petroltype="{{CarPetrolTypeDescription}}"
									   data-cars-consum="{{CarPetrolConsumption}}"
									   data-cars-date="{{CarManufactureDate}}"
									   data-cars-state="{{CarStateDescription}}"
									   role="button" onclick="carController.carDetails(this)">
										<span class="glyphicon glyphicon-file" aria-hidden="true">&nbsp;</span>@Resources.Resource.CarsDetails
									</a>
									{{#ifCond OwnerId UserId}}
									<a class="btn btn-warning" href="#" data-cars-id="{{Id}}" data-cars-name="{{CarName}}" role="button" onclick="carController.giveCar(this)">
										<span class="glyphicon glyphicon-user" aria-hidden="true">&nbsp;</span>@Resources.Resource.ChangeDriver
									</a>
									{{else}}
									<a class="btn btn-info" href="#" data-cars-id="{{Id}}" data-cars-name="{{CarName}}" data-cars-owner="{{OwnerId}}" role="button" onclick="carController.returnCar(this)">
										<span class="glyphicon glyphicon-user" aria-hidden="true">&nbsp;</span>@Resources.Resource.Return
									</a>
									{{/ifCond}}
								</td>
							</tr>
							{{/each}}
						</script>
					</tbody>
				</table>
				@Html.Partial("_DeleteCarPartial", Model.Cars)
				@Html.Partial("_EditCarPartial", Model.Cars)
				@Html.Partial("_AddCarPartial", Model.Cars)
				@Html.Partial("_CarDetails", Model.Cars)
				@Html.Partial("_GiveCarPartial", Model)
				@Html.Partial("_ReturnCarPartial", Model.Cars)
			</div>
		</div>
	</div>
</div>

@section scripts{
	<script src="~/Scripts/moment.js"></script>
	<script src="~/Scripts/bootstrap-datetimepicker.js"></script>
	<script type="text/javascript">
		$(function () {
			$('#datetimepicker1').datetimepicker({
				format: 'DD.MM.YYYY',
				toolbarPlacement: 'top',
			});
		});
	</script>
	<script type="text/javascript">
		$(function () {
			$('#datetimepicker2').datetimepicker({
				format: 'DD.MM.YYYY',
				toolbarPlacement: 'top',
			});
		});
	</script>

}
<script>
	var carParkTemplate = Handlebars.compile($("#carListRow").html());

	var encodedCarData = @Html.Raw(Newtonsoft.Json.JsonConvert.SerializeObject(Model.Cars.ToList()));

	var userId = @Html.Raw((Session["User"] as Model.DTO.UserDTO).Id);
	var ownerId = @Html.Raw((Session["User"] as Model.DTO.UserDTO).Id);
</script>
<script type="text/javascript" src="~/Scripts/AutoParkScripts.js"></script>
<script type="text/javascript" src="~/Scripts/HandlebarsCustomHelpers.js"></script>